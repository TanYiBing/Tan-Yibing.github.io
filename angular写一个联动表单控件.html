<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>angular写一个联动表单控件 | Ice Panpan&#39;s blog | Tan Yibing&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Angular,Typescript,Material">
    <meta name="description" content="首先展示下这个表单的样式：                                                                                                              这就是我们需要设计成的表单样式，从图中我们可以看出这个表单可以分成三个部分：  证件输入部分 出生日期部分 地址部分  我们不应该将这些部分都写在一起，因">
<meta name="keywords" content="Angular,Typescript,Material">
<meta property="og:type" content="website">
<meta property="og:title" content="angular写一个联动表单控件">
<meta property="og:url" content="http://tanyibing.com/angular写一个联动表单控件.html">
<meta property="og:site_name" content="Ice Panpan&#39;s blog">
<meta property="og:description" content="首先展示下这个表单的样式：                                                                                                              这就是我们需要设计成的表单样式，从图中我们可以看出这个表单可以分成三个部分：  证件输入部分 出生日期部分 地址部分  我们不应该将这些部分都写在一起，因">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://tanyibing.com/img/form/1.png">
<meta property="og:image" content="http://tanyibing.com/img/form/shenfen.gif">
<meta property="og:image" content="http://tanyibing.com/img/form/age.gif">
<meta property="og:image" content="http://tanyibing.com/img/form/area.gif">
<meta property="og:image" content="http://tanyibing.com/img/form/form.gif">
<meta property="og:updated_time" content="2018-10-30T13:53:26.281Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="angular写一个联动表单控件">
<meta name="twitter:description" content="首先展示下这个表单的样式：                                                                                                              这就是我们需要设计成的表单样式，从图中我们可以看出这个表单可以分成三个部分：  证件输入部分 出生日期部分 地址部分  我们不应该将这些部分都写在一起，因">
<meta name="twitter:image" content="http://tanyibing.com/img/form/1.png">
    
        <link rel="alternate" type="application/atom+xml" title="Ice Panpan&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/avatar_before.jpg">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Ice Panpan(Tan Yibing)</h5>
          <a href="mailto:tanyibing1995@gmail.com" title="tanyibing1995@gmail.com" class="mail">tanyibing1995@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/TanYiBing" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://weibo.com/u/5341296740?refer_flag=1005055010_" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/friendLink"  >
                <i class="icon icon-lg icon-users"></i>
                友链
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">angular写一个联动表单控件</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
        
            <a id="header-high" style="text-decoration: none; margin-left:12px; width:71px; margin-right:5px" class="header-icon waves-effect waves-circle waves-light" onclick="javascript:(    /*     * Copyright (C) 2015 Rocko (rocko.xyz) <rocko.zxp@gmail.com>     *     * Licensed under the Apache License, Version 2.0 (the 'License');     * you may not use this file except in compliance with the License.     * You may obtain a copy of the License at     *     *      http://www.apache.org/licenses/LICENSE-2.0     *     * Unless required by applicable law or agreed to in writing, software     * distributed under the License is distributed on an 'AS IS' BASIS,     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.     * See the License for the specific language governing permissions and     * limitations under the License.     */    function go() {        function c() {        var e = document.createElement('link');        e.setAttribute('type', 'text/css');        e.setAttribute('rel', 'stylesheet');        e.setAttribute('href', f);        e.setAttribute('class', l);        document.body.appendChild(e)    }     function h() {        var e = document.getElementsByClassName(l);        for (var t = 0; t < e.length; t++) {            document.body.removeChild(e[t])        }    }     function p() {        var e = document.createElement('div');        e.setAttribute('class', a);        document.body.appendChild(e);        setTimeout(function() {            document.body.removeChild(e)        }, 100)    }     function d(e) {        return {            height : e.offsetHeight,            width : e.offsetWidth        }    }     function v(i) {        var s = d(i);        return s.height > e &amp;&amp; s.height < n &amp;&amp; s.width > t &amp;&amp; s.width < r    }     function m(e) {        var t = e;        var n = 0;        while (!!t) {            n += t.offsetTop;            t = t.offsetParent        }        return n    }     function g() {        var e = document.documentElement;        if (!!window.innerWidth) {            return window.innerHeight        } else if (e &amp;&amp; !isNaN(e.clientHeight)) {            return e.clientHeight        }        return 0    }     function y() {        if (window.pageYOffset) {            return window.pageYOffset        }        return Math.max(document.documentElement.scrollTop, document.body.scrollTop)    }     function E(e) {        var t = m(e);        return t >= w &amp;&amp; t <= b + w    }     var songs = [               'http://rocko-blog.qiniudn.com/Music-Wake-Live.mp3' ,     'http://rocko-blog.qiniudn.com/Music-Fashion_Show.mp3'           ,                'http://rocko-blog.qiniudn.com/Music-outside.mp3',                'http://rocko-blog.qiniudn.com/Music-sunburst.mp3'    ];    function S() {        var e = document.getElementById('audio_element_id');        if(e != null){            var index = parseInt(e.getAttribute('curSongIndex'));            if(index > songs.length - 2) {                index = 0;            } else {                index++;            }            e.setAttribute('curSongIndex', index);            N();        }        e.src = i;        e.play()    }     function x(e) {        e.className += ' ' + s + ' ' + o    }     function T(e) {        e.className += ' ' + s + ' ' + u[Math.floor(Math.random() * u.length)]    }     function N() {        var e = document.getElementsByClassName(s);        var t = new RegExp('\\b' + s + '\\b');        for (var n = 0; n < e.length; ) {            e[n].className = e[n].className.replace(t, '')        }    }    function initAudioEle() {        var e = document.getElementById('audio_element_id');        if(e === null){            e = document.createElement('audio');            e.setAttribute('class', l);            e.setAttribute('curSongIndex', 0);            e.id = 'audio_element_id';            e.loop = false;            e.bgcolor = 0;            e.addEventListener('canplay', function() {            setTimeout(function() {                x(k)            }, 500);            setTimeout(function() {                N();                p();                for (var e = 0; e < O.length; e++) {                    T(O[e])                }            }, 15500)        }, true);        e.addEventListener('ended', function() {            N();            h();            go();        }, true);        e.innerHTML = ' <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p> <p>';        document.body.appendChild(e);        }    }        initAudioEle();    var e = 30;    var t = 30;    var n = 350;    var r = 350;    var curSongIndex = parseInt(document.getElementById('audio_element_id').getAttribute('curSongIndex'));    var i = songs[curSongIndex];        var s = 'mw-harlem_shake_me';    var o = 'im_first';    var u = ['im_drunk', 'im_baked', 'im_trippin', 'im_blown'];    var a = 'mw-strobe_light';    var f = 'https://rocko.xyz/css/harlem-shake-style.css';        var l = 'mw_added_css';    var b = g();    var w = y();    var C = document.getElementsByTagName('*');    var k = null;    for (var L = 0; L < C.length; L++) {        var A = C[L];        if (v(A)) {            if (E(A)) {                k = A;                break            }        }    }    if (A === null) {        console.warn('Could not find a node of the right size. Please try a different page.');        return    }    c();    S();    var O = [];    for (var L = 0; L < C.length; L++) {        var A = C[L];        if (v(A)) {            O.push(A)        }    }    })()">
        <i class="icon icon-lg icon-music"></i> High~
        </a>
        </a>
        
    </div>
</header>
<header class="content-header page-header">

    <div class="container fade-scale">
        <h1 class="title">angular写一个联动表单控件</h1>
        <h5 class="subtitle">
            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    <article class="page-article fade" itemprop="blogPage">
        <div class="post-content page-content" id="page-content" itemprop="pageContent">
            <p>首先展示下这个表单的样式：</p>
<blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/form/1.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
</blockquote>
<p>这就是我们需要设计成的表单样式，从图中我们可以看出这个表单可以分成三个部分：</p>
<ol>
<li>证件输入部分</li>
<li>出生日期部分</li>
<li>地址部分</li>
</ol>
<p>我们不应该将这些部分都写在一起，因为这样我们的表单将会特别复杂，因为我们将所有的逻辑都写在了一起，而且也不适合复用。所有我们将这三个部分写成三个控件，下面就分别给出模版：</p>
<ol>
<li><p>证件输入部分模版：</p>
<pre><code>&lt;div&gt;
    &lt;mat-form-field&gt;
        &lt;mat-select placeholder=&quot;证件类型&quot; (ngModelChange)=&quot;onIdTypeChange($event.value)&quot; [(ngModel)]=&quot;identity.identityType&quot;&gt;
            &lt;mat-option *ngFor=&quot;let type of identityTypes&quot; [value]=&quot;type.value&quot;&gt;
            {{type.label}}
            &lt;/mat-option&gt;
        &lt;/mat-select&gt;
    &lt;/mat-form-field&gt;
&lt;/div&gt;
&lt;div class=&quot;id-input&quot;&gt;
    &lt;mat-form-field&gt;
        &lt;input matInput type=&quot;text&quot; placeholder=&quot;证件号码&quot; (change)=&quot;onIdNoChange($event.target.value)&quot; [(ngModel)]=&quot;identity.identityNo&quot;&gt;
    &lt;mat-error&gt;证件号码输入有误&lt;/mat-error&gt;
    &lt;/mat-form-field&gt;
&lt;/div&gt;
</code></pre></li>
<li><p>出生日期部分模版:</p>
<pre><code>&lt;div [formGroup]=&quot;form&quot;&gt;
    &lt;div&gt;
        &lt;mat-form-field&gt;
            &lt;input matInput [matDatepicker]=&quot;birthPicker&quot; type=&quot;text&quot; placeholder=&quot;出生日期&quot; formControlName=&quot;birthday&quot;&gt;
            &lt;mat-datepicker-toggle matSuffix [for]=&quot;birthPicker&quot;&gt;&lt;/mat-datepicker-toggle&gt;
            &lt;mat-datepicker #dueDatePicker&gt;&lt;/mat-datepicker&gt;
            &lt;mat-error&gt;日期不正确&lt;/mat-error&gt;
        &lt;/mat-form-field&gt;
        &lt;mat-datepicker touchUi=&quot;true&quot; #birthPicker&gt;&lt;/mat-datepicker&gt;
    &lt;/div&gt;
    &lt;ng-container formGroupName=&quot;age&quot;&gt;
        &lt;div&gt;
            &lt;mat-form-field&gt;
                &lt;input matInput type=&quot;number&quot; placeholder=&quot;年龄&quot; formControlName=&quot;ageNum&quot;&gt;
            &lt;/mat-form-field&gt;
        &lt;/div&gt;
        &lt;div&gt;
            &lt;mat-button-toggle-group formControlName=&quot;ageUnit&quot; [(ngModel)]=&quot;selectedUnit&quot;&gt;
                &lt;mat-button-toggle *ngFor=&quot;let unit of ageUnits&quot; [value]=&quot;unit.value&quot;&gt;
                    {{ unit.label }}
                &lt;/mat-button-toggle&gt;
            &lt;/mat-button-toggle-group&gt;
        &lt;/div&gt;
        &lt;mat-error class=&quot;mat-body-2&quot; *ngIf=&quot;form.get(&apos;age&apos;).hasError(&apos;ageInvalid&apos;)&quot;&gt;年龄或单位不正确&lt;/mat-error&gt;
    &lt;/ng-container&gt;
&lt;/div&gt;
</code></pre></li>
</ol>
<ol start="3">
<li><p>地址部分模版:</p>
<pre><code>&lt;div class=&quot;address-group&quot;&gt;
    &lt;mat-form-field&gt;
        &lt;mat-select placeholder=&quot;请选择省份&quot; [(ngModel)]=&quot;_address.province&quot; (ngModelChange)=&quot;onProvinceChange()&quot;&gt;
            &lt;mat-option *ngFor=&quot;let p of provinces$ | async&quot; [value]=&quot;p&quot;&gt;
                {{ p }}
            &lt;/mat-option&gt;
        &lt;/mat-select&gt;
    &lt;/mat-form-field&gt;
    &lt;mat-form-field&gt;
        &lt;mat-select placeholder=&quot;请选择城市&quot; [(ngModel)]=&quot;_address.city&quot; (ngModelChange)=&quot;onCityChange()&quot;&gt;
            &lt;mat-option *ngFor=&quot;let c of cities$ | async&quot; [value]=&quot;c&quot;&gt;
                {{ c }}
            &lt;/mat-option&gt;
        &lt;/mat-select&gt;
    &lt;/mat-form-field&gt;
    &lt;mat-form-field&gt;
        &lt;mat-select placeholder=&quot;请选择区县&quot; [(ngModel)]=&quot;_address.district&quot; (ngModelChange)=&quot;onDistrictChange()&quot;&gt;
            &lt;mat-option *ngFor=&quot;let d of districts$ | async&quot; [value]=&quot;d&quot;&gt;
                {{ d }}
            &lt;/mat-option&gt;
        &lt;/mat-select&gt;
    &lt;/mat-form-field&gt;
    &lt;div class=&quot;street&quot;&gt;
        &lt;mat-form-field&gt;
            &lt;input matInput placeholder=&quot;街道地址&quot; [(ngModel)]=&quot;_address.street&quot; (ngModelChange)=&quot;onStreetChange()&quot;&gt;
        &lt;/mat-form-field&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre></li>
</ol>
<p>我使用的是<code>material</code>主题，模版看起来可能有点复杂。接下来我们分别看下每个模块需要实现的效果：</p>
<ol>
<li><p>证件部分就是正常的输入，但是后面要实现一个联动的效果，因为省份证包含了很多信息。</p>
<blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/form/shenfen.gif" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
</blockquote>
</li>
<li><p>年龄部分本身就需要一个联动，效果如下：</p>
<blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/form/age.gif" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
</blockquote>
</li>
<li><p>地区部分需要需要根据其他选择项进行筛选：</p>
<blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/form/area.gif" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
</blockquote>
</li>
<li><p>最后我们需要有一个根据身份证信息，得到我们地址和生日的联动，最终的效果如下：</p>
<blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/form/form.gif" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
</blockquote>
</li>
</ol>
<p>效果我们有已经看到了，接下来就要对各个控件进行编写了：</p>
<ol>
<li><p>证件部分:</p>
<pre><code>import { Component, OnInit, forwardRef, OnDestroy, ChangeDetectionStrategy } from &apos;@angular/core&apos;;
import { NG_VALUE_ACCESSOR, NG_VALIDATORS, ControlValueAccessor, FormControl } from &apos;@angular/forms&apos;;
import { Subscription, Subject, Observable, combineLatest } from &apos;rxjs&apos;;
import { IdentityType, Identity } from &apos;../../domain&apos;;

@Component({
    selector: &apos;app-identity-input&apos;,
    templateUrl: &apos;./identity-input.component.html&apos;,
    styleUrls: [&apos;./identity-input.component.scss&apos;],
    providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() =&gt; IdentityInputComponent),
            multi: true,
        },
        {
            provide: NG_VALIDATORS,
            useExisting: forwardRef(() =&gt; IdentityInputComponent),
            multi: true,
        }
    ],
    changeDetection: ChangeDetectionStrategy.OnPush,
})
export class IdentityInputComponent implements ControlValueAccessor, OnInit, OnDestroy {

    identityTypes: { value: IdentityType, label: string }[] = [
        { value: IdentityType.IdCard, label: &apos;身份证&apos; },
        { value: IdentityType.Insurance, label: &apos;医保&apos; },
        { value: IdentityType.Passport, label: &apos;护照&apos; },
        { value: IdentityType.Military, label: &apos;军官证&apos; },
        { value: IdentityType.Other, label: &apos;其它&apos; }
    ];
    identity: Identity = { identityType: null, identityNo: null };
    private _idType = new Subject&lt;IdentityType&gt;();
    private _idNo = new Subject&lt;string&gt;();
    private _sub: Subscription;
    private propagateChange = (_: any) =&gt; { };

    constructor() { }

    ngOnInit() {
        const val$ = combineLatest(this.idType, this.idNo, (_type, _no) =&gt; {
            return {
                identityType: _type,
                identityNo: _no
            };
        });
        this._sub = val$.subscribe(v =&gt; {
            this.identity = v;
            this.propagateChange(v);
        });
    }

    ngOnDestroy(): void {
        if (this._sub) {
            this._sub.unsubscribe();
        }
    }

    writeValue(obj: any): void {
    }

    registerOnChange(fn: any): void {
        this.propagateChange = fn;
    }

    registerOnTouched(fn: any): void {
    }

    setDisabledState?(isDisabled: boolean): void {
    }

    // 验证表单，验证结果正确返回 null 否则返回一个验证结果对象
    validate(c: FormControl): { [key: string]: any } {
        if (!c.value) {
            return null;
        }
        switch (c.value.identityType) {
            case IdentityType.IdCard: {
                return this.validateIdCard(c);
            }
            case IdentityType.Passport: {
                return this.validatePassport(c);
            }
            case IdentityType.Military: {
                return this.validateMilitary(c);
            }
            case IdentityType.Insurance:
            default: {
                return null;
            }
        }
    }

    onIdTypeChange(idType) {
        this._idType.next(idType);
    }

    onIdNoChange(idNo) {
        this._idNo.next(idNo);
    }

    private get idType(): Observable&lt;IdentityType&gt; {
        return this._idType.asObservable();
    }

    private get idNo(): Observable&lt;string&gt; {
        return this._idNo.asObservable();
    }

    private validateIdCard(c: FormControl): { [key: string]: any } {
        const val = c.value.identityNo;
        if (val.length !== 18) {
            return {
                idNotValid: true
            };
        }
        const pattern = /^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}[x0-9]$/;
        return pattern.test(val) ? null : { idNotValid: true };
    }

    private validatePassport(c: FormControl): { [key: string]: any } {
        const value = c.value.identityNo;
        if (value.length !== 9) {
            return { idNotValid: true };
        }
        const pattern = /^[GgEe]\d{8}$/;
        return pattern.test(value) ? null : { idNotValid: true };
    }

    private validateMilitary(c: FormControl): { [key: string]: any } {
        const value = c.value.identityNo;
        const pattern = /[\u4e00-\u9fa5](字第)(\d{4,8})(号?)$/;
        return pattern.test(value) ? null : { idNotValid: true };
    }
}
</code></pre></li>
<li><p>年龄部分:</p>
<pre><code>import { Component, forwardRef, OnInit, OnDestroy, Input } from &apos;@angular/core&apos;;
import { FormGroup, NG_VALUE_ACCESSOR, NG_VALIDATORS, ControlValueAccessor, FormControl, FormBuilder } from &apos;@angular/forms&apos;;
import { map, merge, filter, startWith, debounceTime, distinctUntilChanged } from &apos;rxjs/operators&apos;;
import { Observable, Subscription, combineLatest } from &apos;rxjs&apos;;
import {
    subDays,
    subMonths,
    subYears,
    differenceInDays,
    differenceInMonths,
    differenceInYears,
    isBefore,
    parse,
    format
} from &apos;date-fns&apos;;
import { isValidDate } from &apos;../../utils/date.util&apos;;

export enum AgeUnit {
    Year = 0,
    Month,
    Day
}

export interface Age {
    age: number;
    unit: AgeUnit;
}

@Component({
    selector: &apos;app-age-input&apos;,
    templateUrl: &apos;./age-input.component.html&apos;,
    styleUrls: [&apos;./age-input.component.scss&apos;],
    providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() =&gt; AgeInputComponent),
            multi: true // 允许令牌多对一
        },
        {
            provide: NG_VALIDATORS,
            useExisting: forwardRef(() =&gt; AgeInputComponent),
            multi: true
        }
    ]
})
export class AgeInputComponent implements ControlValueAccessor, OnInit, OnDestroy {

    @Input() daysTop = 90;
    @Input() daysBottom = 0;
    @Input() monthsTop = 24;
    @Input() monthsBottom = 1;
    @Input() yearsTop = 150;
    @Input() yearsBottom = 1;
    @Input() format = &apos;YYYY-MM-DD&apos;;
    @Input() debounceTime = 300;
    selectedUnit = AgeUnit.Year;
    ageUnits = [
        { value: AgeUnit.Year, label: &apos;岁&apos; },
        { value: AgeUnit.Month, label: &apos;月&apos; },
        { value: AgeUnit.Day, label: &apos;日&apos; }
    ];
    form: FormGroup;
    sub: Subscription;
    private propagateChange = (_: any) =&gt; { };

    constructor(private fb: FormBuilder) { }

    ngOnInit(): void {
        this.form = this.fb.group({
            birthday: [&apos;&apos;, this.validateDate],
            age: this.fb.group({
                ageNum: [&apos;&apos;],
                ageUnit: [AgeUnit.Year]
            }, { validator: this.validateAge(&apos;ageNum&apos;, &apos;ageUnit&apos;) })
        });
        const birthday = this.form.get(&apos;birthday&apos;);
        const ageNum = this.form.get(&apos;age&apos;).get(&apos;ageNum&apos;);
        const ageUnit = this.form.get(&apos;age&apos;).get(&apos;ageUnit&apos;);

        const birthday$ = birthday.valueChanges.pipe(
            map(d =&gt; {
                return { date: d, from: &apos;birthday&apos; };
            }),
            debounceTime(this.debounceTime),
            distinctUntilChanged(),
            filter(_ =&gt; birthday.valid)
        );
        const ageNum$ = ageNum.valueChanges.pipe(
            startWith(ageNum.value),
            debounceTime(this.debounceTime),
            distinctUntilChanged(),
        );
        const ageUnit$ = ageUnit.valueChanges.pipe(
            startWith(ageUnit.value),
            debounceTime(this.debounceTime),
            distinctUntilChanged()
        );

        // rxjs6版本中方法被改造了
        const age$ = combineLatest(ageNum$, ageUnit$).pipe(
            map(([_n, _u]) =&gt; this.toDate({ age: _n, unit: _u })),
            map(d =&gt; {
                return { date: d, from: &apos;age&apos; };
            }),
            filter(_ =&gt; this.form.get(&apos;age&apos;).valid)
        );
        const merged$ = Observable.prototype.pipe(
            merge(birthday$, age$),
            filter(_ =&gt; this.form.valid)
        );
        this.sub = merged$.subscribe(d =&gt; {
            const age = this.toAge(d.date);
            if (d.from === &apos;birthday&apos;) {
                if (age.age !== ageNum.value) {
                    ageNum.patchValue(age.age, { emitEvent: false });
                }
                if (age.unit !== ageUnit.value) {
                    this.selectedUnit = age.unit;
                    ageUnit.patchValue(age.age, { emitEvent: false });
                }
                this.propagateChange(d.date);
            } else {
                const ageToCompare = this.toAge(this.form.get(&apos;birthday&apos;).value);
                if (age.age !== ageToCompare.age || age.unit !== ageToCompare.unit) {
                    birthday.patchValue(d.date, { emitEvent: false });
                    this.propagateChange(d.date);
                }
            }
        });
    }

    ngOnDestroy(): void {
        if (this.sub) {
            this.sub.unsubscribe();
        }
    }

    writeValue(obj: any): void {
        if (obj) {
            const date = format(obj, this.format);
            this.form.get(&apos;birthday&apos;).patchValue(date);
            const age = this.toAge(date);
            this.form.get(&apos;age&apos;).get(&apos;ageNum&apos;).patchValue(age.age);
            this.form.get(&apos;age&apos;).get(&apos;ageUnit&apos;).patchValue(age.unit);
        }
    }
    registerOnChange(fn: any): void {
        this.propagateChange = fn;
    }
    registerOnTouched(fn: any): void {
    }
    setDisabledState?(isDisabled: boolean): void {
    }
</code></pre></li>
</ol>
<pre><code>    toAge(dateStr: string): Age {
        const date = parse(dateStr);
        const now = Date.now();
        return isBefore(subDays(now, this.daysTop), date) ?
            { age: differenceInDays(now, date), unit: AgeUnit.Day } :
            isBefore(subMonths(now, this.monthsTop), date) ?
                { age: differenceInMonths(now, date), unit: AgeUnit.Month } :
                { age: differenceInYears(now, date), unit: AgeUnit.Year };
    }

    toDate(age: Age): string {
        const now = Date.now();
        switch (age.unit) {
            case AgeUnit.Year: {
                return format(subYears(now, age.age), this.format);
            }
            case AgeUnit.Month: {
                return format(subMonths(now, age.age), this.format);
            }
            case AgeUnit.Day: {
                return format(subDays(now, age.age), this.format);
            }
            default: {
                return null;
            }
        }
    }

    validate(c: FormControl): { [key: string]: any } {
        const val = c.value;
        if (!val) {
            return null;
        }
        if (isValidDate(val)) {
            return null;
        }
        return {
            dateOfBirthInvalid: true
        };
    }


    // 表单验证器
    validateAge(ageNumkey: string, ageUnitKey: string) {
        return (group: FormGroup): { [key: string]: any } =&gt; {
            const ageNum = group.controls[ageNumkey];
            const ageUnit = group.controls[ageUnitKey];
            let result = false;
            const ageNumVal = ageNum.value;
            switch (ageUnit.value) {
                case AgeUnit.Year: {
                    result = ageNumVal &gt;= this.yearsBottom &amp;&amp; ageNumVal &lt; this.yearsTop;
                    break;
                }
                case AgeUnit.Month: {
                    result = ageNumVal &gt;= this.monthsBottom &amp;&amp; ageNumVal &lt; this.monthsTop;
                    break;
                }
                case AgeUnit.Day: {
                    result = ageNumVal &gt;= this.daysBottom &amp;&amp; ageNumVal &lt; this.daysTop;
                    break;
                }
                default: {
                    break;
                }
            }
            return result ? null : { ageInvalid: true };
        };
    }

    validateDate(c: FormControl): { [key: string]: any } {
        const val = c.value;
        return isValidDate(val) ? null : {
            birthdayInvalid: true
        };
    }

}
</code></pre><ol start="3">
<li><p>地区部分:</p>
<pre><code>import { Component, OnInit, forwardRef, ChangeDetectionStrategy, OnDestroy } from &apos;@angular/core&apos;;
import { NG_VALUE_ACCESSOR, NG_VALIDATORS, ControlValueAccessor, FormControl } from &apos;@angular/forms&apos;;
import { Subscription, Subject, combineLatest, Observable, of } from &apos;rxjs&apos;;
import { Address } from &apos;../../domain/user.model&apos;;
import { startWith, map } from &apos;rxjs/operators&apos;;
import { getProvinces, getCitiesByProvince, getAreasByCity } from &apos;../../utils/area.util&apos;;

@Component({
    selector: &apos;app-area-list&apos;,
    templateUrl: &apos;./area-list.component.html&apos;,
    styleUrls: [&apos;./area-list.component.scss&apos;],
    providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() =&gt; AreaListComponent),
            multi: true,
        },
        {
            provide: NG_VALIDATORS,
            useExisting: forwardRef(() =&gt; AreaListComponent),
            multi: true,
        },
    ],
    changeDetection: ChangeDetectionStrategy.OnPush,
})
export class AreaListComponent implements ControlValueAccessor, OnInit, OnDestroy {

    _address: Address = {
        province: &apos;&apos;,
        city: &apos;&apos;,
        district: &apos;&apos;,
        street: &apos;&apos;
    };
    _province = new Subject();
    _city = new Subject();
    _district = new Subject();
    _street = new Subject();
    provinces$: Observable&lt;string[]&gt;;
    cities$: Observable&lt;string[]&gt;;
    districts$: Observable&lt;string[]&gt;;
    private _sub: Subscription;
    private propagateChange = (_: any) =&gt; { };

    constructor() { }

    ngOnInit() {
        const province$ = this._province.asObservable().pipe(startWith(&apos;&apos;));
        const city$ = this._city.asObservable().pipe(startWith(&apos;&apos;));
        const district$ = this._district.asObservable().pipe(startWith(&apos;&apos;));
        const street$ = this._street.asObservable().pipe(startWith(&apos;&apos;));
        const val$ = combineLatest([province$, city$, district$, street$], (_p, _c, _d, _s) =&gt; {
            return {
                province: _p,
                city: _c,
                district: _d,
                street: _s
            };
        });
        this._sub = val$.subscribe(v =&gt; {
            this.propagateChange(v);
        });

        this.provinces$ = of(getProvinces());
        // 根据省份的选择得到城市列表
        this.cities$ = province$.pipe(
            map((p: string) =&gt; getCitiesByProvince(p))
        );
        // 根据省份和城市的选择得到地区列表
        this.districts$ = combineLatest(province$, city$, (p, c) =&gt; ({ province: p, city: c })).pipe(
            map(a =&gt; getAreasByCity(a.province, a.city))
        );
    }

    ngOnDestroy(): void {
        if (this._sub) {
            this._sub.unsubscribe();
        }
    }

    // 设置初始值
    writeValue(obj: Address): void {
        if (obj) {
            this._address = obj;
            if (this._address.province) {
                this._province.next(this._address.province);
            }
            if (this._address.city) {
                this._city.next(this._address.city);
            }
            if (this._address.district) {
                this._district.next(this._address.district);
            }
            if (this._address.street) {
                this._street.next(this._address.street);
            }
        }
    }
    registerOnChange(fn: any): void {
        this.propagateChange = fn;
    }
    registerOnTouched(fn: any): void {
    }
    setDisabledState?(isDisabled: boolean): void {
    }

    // 验证表单，验证结果正确返回 null 否则返回一个验证结果对象
    validate(c: FormControl): { [key: string]: any } {
        const val = c.value;
        if (!val) {
            return null;
        }
        if (val.province &amp;&amp; val.city &amp;&amp; val.district &amp;&amp; val.street &amp;&amp; val.street.length &gt;= 4) {
            return null;
        }
        return {
            addressNotValid: true
        };
    }

    onProvinceChange() {
        this._province.next(this._address.province);
    }

    onCityChange() {
        this._city.next(this._address.city);
    }

    onDistrictChange() {
        this._district.next(this._address.district);
    }

    onStreetChange() {
        this._street.next(this._address.street);
    }
}
</code></pre></li>
</ol>
<p>当然了，这些不是全部的代码，有些重复的功能我写成了单独的ts文件，有兴趣的可以去我的<a href="https://github.com/TanYiBing/taskmgr" target="_blank" rel="noopener">github</a>上看。</p>
<p>这样我们只是完成了各个自定义控件，这样的好处是我们的控件可以重复使用，而且各部分逻辑都在各自的部分，所以最后我们需要一个整体来包含这些控件。</p>
<pre><code>&lt;form [formGroup]=&quot;form&quot; (ngSubmit)=&quot;onSubmit(form, $event)&quot;&gt;
    &lt;mat-card&gt;
        &lt;mat-tab-group&gt;
            &lt;mat-tab label=&quot;帐号信息&quot;&gt;
                &lt;mat-card-header&gt;
                    &lt;mat-card-title&gt;注册&lt;/mat-card-title&gt;
                &lt;/mat-card-header&gt;
                &lt;mat-card-content&gt;
                    &lt;mat-form-field class=&quot;full-width&quot;&gt;
                        &lt;input matInput placeholder=&quot;您的email*&quot; type=&quot;email&quot; formControlName=&quot;email&quot;&gt;
                    &lt;/mat-form-field&gt;
                    &lt;mat-form-field class=&quot;full-width&quot;&gt;
                        &lt;input matInput placeholder=&quot;您的姓名*&quot; type=&quot;text&quot; formControlName=&quot;name&quot;&gt;
                    &lt;/mat-form-field&gt;
                    &lt;mat-form-field class=&quot;full-width&quot;&gt;
                        &lt;input matInput placeholder=&quot;输入您的密码*&quot; type=&quot;password&quot; formControlName=&quot;password&quot;&gt;
                    &lt;/mat-form-field&gt;
                    &lt;mat-form-field class=&quot;full-width&quot;&gt;
                        &lt;input matInput placeholder=&quot;重复输入您的密码*&quot; type=&quot;password&quot; formControlName=&quot;repeat&quot;&gt;
                    &lt;/mat-form-field&gt;
                    &lt;app-image-list-select [useSvgIcon]=&quot;true&quot; [cols]=&quot;6&quot; [title]=&quot;&apos;选择头像：&apos;&quot; [items]=&quot;items&quot; formControlName=&quot;avatar&quot;&gt;
                    &lt;/app-image-list-select&gt;
                    &lt;button mat-raised-button color=&quot;primary&quot; type=&quot;submit&quot;&gt;注册&lt;/button&gt;
                &lt;/mat-card-content&gt;
                &lt;mat-card-actions class=&quot;text-right&quot;&gt;
                    &lt;p&gt;已有账户？&lt;a href=&quot;&quot;&gt;登录&lt;/a&gt;&lt;/p&gt;
                    &lt;p&gt;忘记密码？&lt;a href=&quot;&quot;&gt;找回&lt;/a&gt;&lt;/p&gt;
                &lt;/mat-card-actions&gt;
            &lt;/mat-tab&gt;
            &lt;mat-tab label=&quot;个人信息&quot;&gt;
                &lt;div class=&quot;full-width control-padding&quot;&gt;
                    &lt;app-identity-input formControlName=&quot;identity&quot; class=&quot;full-width control-padding&quot;&gt;&lt;/app-identity-input&gt;
                &lt;/div&gt;
                &lt;div class=&quot;full-width control-padding&quot;&gt;
                    &lt;app-age-input formControlName=&quot;dateOfBirth&quot;&gt;&lt;/app-age-input&gt;
                &lt;/div&gt;
                &lt;div class=&quot;full-width control-padding&quot;&gt;
                    &lt;app-area-list formControlName=&quot;address&quot;&gt;&lt;/app-area-list&gt;
                &lt;/div&gt;
            &lt;/mat-tab&gt;
        &lt;/mat-tab-group&gt;
    &lt;/mat-card&gt;
&lt;/form&gt;
</code></pre><p>这个部分的处理逻辑如下：</p>
<pre><code>import { Component, OnInit, OnDestroy } from &apos;@angular/core&apos;;
import { FormBuilder, Validators, FormGroup } from &apos;@angular/forms&apos;;
import { debounceTime, filter } from &apos;rxjs/operators&apos;;
import { Subscription } from &apos;rxjs&apos;;
import { extractInfo, isValidAddr, getAddrByCode } from &apos;../../utils/identity.util&apos;;
import { isValidDate } from &apos;../../utils/date.util&apos;;

@Component({
    selector: &apos;app-register&apos;,
    templateUrl: &apos;./register.component.html&apos;,
    styleUrls: [&apos;./register.component.scss&apos;]
})
export class RegisterComponent implements OnInit, OnDestroy {

    items: string[];
    form: FormGroup;
    sub: Subscription;
    private readonly avatarName = &apos;avatars&apos;;
    constructor(private fb: FormBuilder) { }

    ngOnInit() {
        const img = `${this.avatarName}:svg-${(Math.random() * 16).toFixed()}`;
        const nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16];
        this.items = nums.map(val =&gt; `avatars:svg-${val}`);
        this.form = this.fb.group({
            email: [&apos;wang@163.com&apos;, Validators.compose([Validators.email, Validators.required])],
            name: [&apos;&apos;],
            password: [&apos;&apos;],
            repeat: [&apos;&apos;],
            avatar: [img],
            dateOfBirth: [&apos;1990-01-01&apos;],
            address: [&apos;&apos;],
            identity: [&apos;&apos;]
        });
        const id$ = this.form.get(&apos;identity&apos;).valueChanges.pipe(
            debounceTime(300),
            filter(_ =&gt; this.form.get(&apos;identity&apos;).valid)
        );
        this.sub = id$.subscribe(id =&gt; {
            const info = extractInfo(id.identityNo);
            if (isValidAddr(info.addrCode)) {
                const addr = getAddrByCode(info.addrCode);
                this.form.get(&apos;address&apos;).patchValue(addr);
            }
            if (isValidDate(info.dateOfBirth)) {
                this.form.get(&apos;dateOfBirth&apos;).patchValue(info.dateOfBirth);
            }
        });
    }

    ngOnDestroy(): void {
        if (this.sub) {
            this.sub.unsubscribe();
        }
    }

    onSubmit({ value, valid }, ev: Event) {
        ev.preventDefault();
        if (!valid) {
            return;
        }
        console.log(value);
    }
}
</code></pre><p>这样就形成了一个完整的自定义表单控件，而且里面部分还可以拿出来单独使用。</p>

        </div>

        

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "4rdRChJgomStDCzm3AqViMI2-gzGzoHsz",
            appKey: "4cekfBC0l7ePUjMgoIGow6DC",
            avatar: "mm",
            placeholder: "要不要说点什么？",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->







    </article>
    
<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>


</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Ice Panpan(Tan Yibing) &copy; 2017 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://tanyibing.com/angular写一个联动表单控件.html&title=《angular写一个联动表单控件》 — Ice Panpan's blog&pic=http://tanyibing.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tanyibing.com/angular写一个联动表单控件.html&title=《angular写一个联动表单控件》 — Ice Panpan's blog&source=I'm TanYiBing,my email is 820567197@qq.com&tanyibing1995@gmail.com,my qq is 8..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://tanyibing.com/angular写一个联动表单控件.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《angular写一个联动表单控件》 — Ice Panpan's blog&url=http://tanyibing.com/angular写一个联动表单控件.html&via=http://tanyibing.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://tanyibing.com/angular写一个联动表单控件.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3a0YojIRAF0Pz/T2dfFxaz95Y9A9Hj09Bot8dATWn5esXt/Vf79/nqyWrUTv+thoGB8bWM98e26pPzVmNXb/g8dknFwMC4gJGEwnZUEiHb7y6fY2BgYJRBNnnz5yCOgYGB8VTAnSWUbVqJgYGBkU8oP4abHbf90l4cAwPjCxnthvM3//6R+gYGBsZXMd5ly4PsTtitZ4WBgXE0Iw9w+Ta17TkrLWBgYNzDeI9asjZJeE1GRUd1GBgYFzBm08pLBbNRRWkTAwPjGkb+4XYjmjxpt77LgIuBgXEooz1K+xwEnyp85guEgYFxNqO9HLZzOSMJtW0yioGBcQOjLVLmiV2bOM76L08NMTAwDmLsHHi15ca8ppqnpxgYGDcw8rRsVnp8KuBGvwMGBsahjKT02IbCfFEerj9iYGBcwGgvW8yQbcmhWBoMDIxDGe21rTyx2w/QwzsjGBgYRzNmKWA+ubZP8X4MDIyjGbMNbfJ85+pYuxAYGBg3MPK0rF2bnYDeFhswMDBuYCTb16euU7QpYBLWMTAwbmP8REBMrp3NeBgYGGcz3mXLj8BmJYdkq/yfpBADA+M4Rhvmdja3s0TzgaljYGAcwUiCbHKUvx9q84Bb//fAwMA4grF/baI9LJsdxi37Y2BgYJQfnl0Oy8P6a7aiGBgY1zBmH37qAG7ZEwMD4wJGfnW1jXUJpkViYGDcxphdcWgn1y7TLMRjYGAcx/gDjdudO8b4ZpoAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
